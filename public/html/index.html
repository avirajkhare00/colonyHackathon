<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Starter Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>
        body {
            padding-top: 50px;
        }
        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }
    </style>

  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Project name</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

      <div class="starter-template">
        <h1>Project X</h1>
      </div>

      <div id="domainAndFund"></div>

    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../js/bootstrap.min.js"></script>

    <!-- import necessary colonyJS libs here -->
    <!-- importing ABIs as of now, no library is needed as of now
    <script src="../js/colony-js-adapter-ethers.js"></script>
    <script src="../js/colony-js-client.js"></script>
    <script src="../js/colony-js-contract-loader-http.js"></script>
    <script src="../js/colony-js-utils.js"></script>
    <script src="../js/ethers.min.js"></script>

    -->

    <!-- loading the minified version -->
    <!-- ipfs js library -->
    <script src="https://unpkg.com/ipfs-api/dist/index.min.js"></script>

    <script>
        
        //starting jQuery code here
        $(document).ready(function(){

            var colonyContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"_parentSkillId","type":"uint256"}],"name":"addDomain","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_parentSkillId","type":"uint256"}],"name":"addGlobalSkill","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"}],"name":"assignWorkRating","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_users","type":"address[]"},{"name":"_amount","type":"int256[]"}],"name":"bootstrapColony","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"}],"name":"cancelTask","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_token","type":"address"}],"name":"claimColonyFunds","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_role","type":"uint256"},{"name":"_token","type":"address"}],"name":"claimPayout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_payoutId","type":"uint256"},{"name":"_squareRoots","type":"uint256[7]"},{"name":"_userReputation","type":"uint256"},{"name":"_totalReputation","type":"uint256"}],"name":"claimRewardPayout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_sigV","type":"uint8[]"},{"name":"_sigR","type":"bytes32[]"},{"name":"_sigS","type":"bytes32[]"},{"name":"_mode","type":"uint8[]"},{"name":"_value","type":"uint256"},{"name":"_data","type":"bytes"}],"name":"executeTaskChange","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_payoutId","type":"uint256"}],"name":"finalizeRewardPayout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"}],"name":"finalizeTask","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"getGlobalRewardPayoutCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_user","type":"address"}],"name":"getUserRewardPayoutCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_network","type":"address"}],"name":"initialiseColony","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_specificationHash","type":"bytes32"},{"name":"_domainId","type":"uint256"}],"name":"makeTask","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_wad","type":"uint256"}],"name":"mintTokens","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_wad","type":"uint256"}],"name":"mintTokensForColonyNetwork","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_fromPot","type":"uint256"},{"name":"_toPot","type":"uint256"},{"name":"_amount","type":"uint256"},{"name":"_token","type":"address"}],"name":"moveFundsBetweenPots","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_role","type":"uint8"},{"name":"_rating","type":"uint8"},{"name":"_salt","type":"bytes32"}],"name":"revealTaskWorkRating","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_specificationHash","type":"bytes32"}],"name":"setTaskBrief","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_domainId","type":"uint256"}],"name":"setTaskDomain","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_dueDate","type":"uint256"}],"name":"setTaskDueDate","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_token","type":"address"},{"name":"_amount","type":"uint256"}],"name":"setTaskEvaluatorPayout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_token","type":"address"},{"name":"_amount","type":"uint256"}],"name":"setTaskManagerPayout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_role","type":"uint8"},{"name":"_user","type":"address"}],"name":"setTaskRoleUser","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_skillId","type":"uint256"}],"name":"setTaskSkill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_token","type":"address"},{"name":"_amount","type":"uint256"}],"name":"setTaskWorkerPayout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_token","type":"address"}],"name":"setToken","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_token","type":"address"}],"name":"startNextRewardPayout","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_deliverableHash","type":"bytes32"}],"name":"submitTaskDeliverable","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_id","type":"uint256"},{"name":"_role","type":"uint8"},{"name":"_ratingSecret","type":"bytes32"}],"name":"submitTaskWorkRating","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"}],"name":"TaskAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"},{"indexed":false,"name":"specificationHash","type":"bytes32"}],"name":"TaskBriefChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"},{"indexed":false,"name":"dueDate","type":"uint256"}],"name":"TaskDueDateChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"},{"indexed":false,"name":"domainId","type":"uint256"}],"name":"TaskDomainChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"},{"indexed":false,"name":"skillId","type":"uint256"}],"name":"TaskSkillChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"},{"indexed":false,"name":"role","type":"uint8"},{"indexed":false,"name":"user","type":"address"}],"name":"TaskRoleUserChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"},{"indexed":false,"name":"token","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"TaskWorkerPayoutChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"}],"name":"TaskFinalized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"}],"name":"TaskCanceled","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"id","type":"uint256"}],"name":"RewardPayoutCycleStarted","type":"event"},{"constant":false,"inputs":[{"name":"_numPayouts","type":"uint256"}],"name":"waiveRewardPayouts","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"authority","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_salt","type":"bytes32"},{"name":"_value","type":"uint256"}],"name":"generateSecret","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"_id","type":"uint256"}],"name":"getDomain","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getDomainCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getFeeInverse","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"_token","type":"address"}],"name":"getNonRewardPotsTotal","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_potId","type":"uint256"},{"name":"_token","type":"address"}],"name":"getPotBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getRewardInverse","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"_payoutId","type":"uint256"}],"name":"getRewardPayoutInfo","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"address"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_id","type":"uint256"}],"name":"getTask","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"bytes32"},{"name":"","type":"bool"},{"name":"","type":"bool"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_id","type":"uint256"}],"name":"getTaskChangeNonce","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getTaskCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_id","type":"uint256"},{"name":"_role","type":"uint256"},{"name":"_token","type":"address"}],"name":"getTaskPayout","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_id","type":"uint256"},{"name":"_role","type":"uint8"}],"name":"getTaskRole","outputs":[{"name":"","type":"address"},{"name":"","type":"bool"},{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_id","type":"uint256"}],"name":"getTaskWorkRatings","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_id","type":"uint256"},{"name":"_role","type":"uint8"}],"name":"getTaskWorkRatingSecret","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getToken","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"key","type":"bytes"},{"name":"value","type":"bytes"},{"name":"branchMask","type":"uint256"},{"name":"siblings","type":"bytes32[]"}],"name":"verifyReputationProof","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"version","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"}]);
            var colonyContractAddress = '0x9B5B236d0a8b344c5908b28F5d68f46E332cb624';

            var colonyTokenAddress = '0x4d2D8454b3591C158f5C70eeA5660e596baAb6cD';

            //imported to get owner of this colony
            var dsauthContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"owner_","type":"address"}],"name":"setOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"authority_","type":"address"}],"name":"setAuthority","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"authority","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"authority","type":"address"}],"name":"LogSetAuthority","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"}],"name":"LogSetOwner","type":"event"}]);
            
            //using ipfs api to send task in ipfs
            var ipfs = window.IpfsApi({
                host : 'https://ipfs.infura.io/',
                port : 5001
              });
            
            //hardcoding JSON here, both DomainId and DomainName.
            //using remix to create domains and to transfer fund to all pots.
            var domainAndNameMapping = [
              {
                'domainName' : 'Grow Project X',
                'domainId' : '1'
              },
              {
                'domainName' : 'Zero Hunger',
                'domainId' : '2'
              },
              {
                'domainName' : 'Education',
                'domainId' : '3'
              },
              {
                'domainName' : 'Clean Water',
                'domainId' : '4'
              }
            ];

            //function to get tokenAddress
            colonyContract.at(colonyContractAddress).getToken.call(function(err, data){
              if(err){console.error(err)}
              else{
                console.log(data);
              }
            })

            //function to get owner address, if ownerAddress == metamask user then show option to create a new project
            colonyContract.at(colonyContractAddress).owner.call(function(err, data){
              if(err){console.error(error)}
              else{
                console.log('metamask owner address: ', web3.eth.accounts[0]);
                colonyContract.at(colonyContractAddress).authority.call(function(err, data){
                  if(err){
                    console.error(err)
                  }else{
                    console.log('authority smart contract address: ', data);

                    //getting owner of authority smart contract address
                    dsauthContract.at(data).owner.call(function(err, data){
                      if(err){console.error(err)}
                      else{
                        console.log('owner address, check metamask address too, ',data)
                        //call if condition and DOM insert functions here
                        if(data == web3.eth.accounts[0]){
                          console.log('owner address, append dom for owner to add domains');
                        }
                      }
                    })
                  }
                })
              }
            })

            //getting pot balance for every project
            //pot balance is transferred using remix
            //if needed, add domain creation and pot transfer option inside admin template
            domainAndNameMapping.forEach(function(domain){

              console.log(domain.domainId);

              colonyContract.at(colonyContractAddress).getPotBalance(domain.domainId, colonyTokenAddress, function(err, data){
                if(err){console.error(err)}
                else{
                  console.log(domain.domainName, web3.fromWei(data).toString());

                  //appending data to main DOM
                  $('#domainAndFund').append(
                    '<p>' +
                      'Project Name: ' + domain.domainName + '<br />' +
                      'Available Fund: ' + web3.fromWei(data).toString() + '<br/>' +
                    '</p>'
                  )

                }
              })

            })

            //function to create a new task.
            //creating new task inside domainId 3
            //need to store JSON inside ipfs
            function createTask(stringifiedJSON){

              

            }

        })

    </script>

  </body>
</html>
